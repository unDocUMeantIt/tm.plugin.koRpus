# Copyright 2015 Meik Michalke <meik.michalke@hhu.de>
#
# This file is part of the R package tm.plugin.koRpus.
#
# tm.plugin.koRpus is free software: you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation, either version 3 of the License, or
# (at your option) any later version.
#
# tm.plugin.koRpus is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with tm.plugin.koRpus.  If not, see <http://www.gnu.org/licenses/>.

#' Getter/setter methods for kRp.corpus objects
#' 
#' These methods should be used to get or set values of text objects
#' generated by functions like \code{\link[tm.plugin.koRpus:simpleCorpus]{simpleCorpus}}.
#' 
#' \itemize{
#'   \item{\code{corpusTagged()} }{returns the list of \code{kRp.tagged} objects.}
#'   \item{\code{corpusReadability()} }{returns the list of \code{kRp.readability} objects.}
#'   \item{\code{corpusTm()} }{returns the \code{VCorpus} object.}
#'   \item{\code{corpusMeta()} }{returns the list with meta information.}
#'   \item{\code{corpusHyphen()} }{returns the list of \code{kRp.hyphen} objects.}
#'   \item{\code{corpusTTR()} }{returns the list of \code{kRp.TTR} objects.}
#' }
#' @param obj An object of class \code{\link[tm.plugin.koRpus]{kRp.corpus-class}},
#'    \code{\link[tm.plugin.koRpus]{kRp.sourcesCorpus-class}} or
#'    \code{\link[tm.plugin.koRpus]{kRp.topicCorpus-class}}.
#' @rdname kRp.corpus_get-methods
#' @docType methods
#' @export
#' @examples
#' \dontrun{
#' corpusTagged(myCorpus)
#' corpusMeta(myCorpus, "note") <- "an interesting read!"
#' }
setGeneric("corpusTagged", function(obj) standardGeneric("corpusTagged"))
#' @rdname kRp.corpus_get-methods
#' @docType methods
#' @export
#' @aliases
#'    corpusTagged,-methods
#'    corpusTagged,kRp.corpus-method
#' @include 01_class_01_kRp.corpus.R
setMethod("corpusTagged",
  signature=signature(obj="kRp.corpus"),
  function (obj){
    result <- slot(obj, name="tagged")
    return(result)
  }
)

#' @rdname kRp.corpus_get-methods
#' @export
#' @docType methods
#' @param value The new value to replace the current with.
setGeneric("corpusTagged<-", function(obj, value) standardGeneric("corpusTagged<-"))
#' @rdname kRp.corpus_get-methods
#' @export
#' @docType methods
#' @aliases
#'    corpusTagged<-,-methods
#'    corpusTagged<-,kRp.corpus-method
#' @include 01_class_01_kRp.corpus.R
setMethod("corpusTagged<-",
  signature=signature(obj="kRp.corpus"),
  function (obj, value){
    slot(obj, name="tagged") <- value
    return(obj)
  }
)

#' @rdname kRp.corpus_get-methods
#' @docType methods
#' @export
setGeneric("corpusReadability", function(obj) standardGeneric("corpusReadability"))
#' @rdname kRp.corpus_get-methods
#' @docType methods
#' @export
#' @aliases
#'    corpusReadability,-methods
#'    corpusReadability,kRp.corpus-method
#' @include 01_class_01_kRp.corpus.R
setMethod("corpusReadability",
  signature=signature(obj="kRp.corpus"),
  function (obj){
    result <- slot(obj, name="readability")
    return(result)
  }
)

#' @rdname kRp.corpus_get-methods
#' @export
#' @docType methods
# @param value The new value to replace the current with.
setGeneric("corpusReadability<-", function(obj, value) standardGeneric("corpusReadability<-"))
#' @rdname kRp.corpus_get-methods
#' @export
#' @docType methods
#' @aliases
#'    corpusReadability<-,-methods
#'    corpusReadability<-,kRp.corpus-method
#' @include 01_class_01_kRp.corpus.R
setMethod("corpusReadability<-",
  signature=signature(obj="kRp.corpus"),
  function (obj, value){
    slot(obj, name="readability") <- value
    return(obj)
  }
)

#' @rdname kRp.corpus_get-methods
#' @docType methods
#' @export
setGeneric("corpusTm", function(obj) standardGeneric("corpusTm"))
#' @rdname kRp.corpus_get-methods
#' @docType methods
#' @export
#' @aliases
#'    corpusTm,-methods
#'    corpusTm,kRp.corpus-method
#' @include 01_class_01_kRp.corpus.R
setMethod("corpusTm",
  signature=signature(obj="kRp.corpus"),
  function (obj){
    result <- slot(obj, name="raw")[["tm"]]
    return(result)
  }
)

#' @rdname kRp.corpus_get-methods
#' @export
#' @docType methods
# @param value The new value to replace the current with.
setGeneric("corpusTm<-", function(obj, value) standardGeneric("corpusTm<-"))
#' @rdname kRp.corpus_get-methods
#' @export
#' @docType methods
#' @aliases
#'    corpusTm<-,-methods
#'    corpusTm<-,kRp.corpus-method
#' @include 01_class_01_kRp.corpus.R
setMethod("corpusTm<-",
  signature=signature(obj="kRp.corpus"),
  function (obj, value){
    slot(obj, name="raw")[["tm"]] <- value
    return(obj)
  }
)

#' @rdname kRp.corpus_get-methods
#' @param meta If not NULL, the \code{meta} list entry of the given name.
#' @param fail Logical, whether the method should fail with an error if \code{meta} was not found.
#'    If set to \code{FALSE}, returns \code{invisible(NULL)} instead.
#' @docType methods
#' @export
setGeneric("corpusMeta", function(obj, meta=NULL, fail=TRUE) standardGeneric("corpusMeta"))
#' @rdname kRp.corpus_get-methods
#' @docType methods
#' @export
#' @aliases
#'    corpusMeta,-methods
#'    corpusMeta,kRp.corpus-method
#' @include 01_class_01_kRp.corpus.R
setMethod("corpusMeta",
  signature=signature(obj="kRp.corpus"),
  function (obj, meta=NULL, fail=TRUE){
    all.meta <- slot(obj, name="meta")
    if(is.null(meta)){
      result <- all.meta
    } else {
      if(meta %in% names(all.meta)){
        result <- all.meta[[meta]]
      } else {
        if(isTRUE(fail)){
          stop(simpleError(paste0("Entry named \"", meta,"\" not found in the slot \"meta\" of this object!")))
        } else {
          result <- invisible(NULL)
        }
      }
    }

    return(result)
  }
)

#' @rdname kRp.corpus_get-methods
#' @export
#' @docType methods
# @param value The new value to replace the current with.
setGeneric("corpusMeta<-", function(obj, meta=NULL, value) standardGeneric("corpusMeta<-"))
#' @rdname kRp.corpus_get-methods
#' @export
#' @docType methods
#' @aliases
#'    corpusMeta<-,-methods
#'    corpusMeta<-,kRp.corpus-method
#' @include 01_class_01_kRp.corpus.R
setMethod("corpusMeta<-",
  signature=signature(obj="kRp.corpus"),
  function (obj, meta=NULL, value){
    if(is.null(meta)){
      slot(obj, name="meta") <- value
    } else {
      slot(obj, name="meta")[[meta]] <- value
    }
    return(obj)
  }
)

#' @rdname kRp.corpus_get-methods
#' @docType methods
#' @export
setGeneric("corpusHyphen", function(obj) standardGeneric("corpusHyphen"))
#' @rdname kRp.corpus_get-methods
#' @docType methods
#' @export
#' @aliases
#'    corpusHyphen,-methods
#'    corpusHyphen,kRp.corpus-method
#' @include 01_class_01_kRp.corpus.R
setMethod("corpusHyphen",
  signature=signature(obj="kRp.corpus"),
  function (obj){
    result <- slot(obj, name="hyphen")
    return(result)
  }
)

#' @rdname kRp.corpus_get-methods
#' @export
#' @docType methods
# @param value The new value to replace the current with.
setGeneric("corpusHyphen<-", function(obj, value) standardGeneric("corpusHyphen<-"))
#' @rdname kRp.corpus_get-methods
#' @export
#' @docType methods
#' @aliases
#'    corpusHyphen<-,-methods
#'    corpusHyphen<-,kRp.corpus-method
#' @include 01_class_01_kRp.corpus.R
setMethod("corpusHyphen<-",
  signature=signature(obj="kRp.corpus"),
  function (obj, value){
    slot(obj, name="hyphen") <- value
    return(obj)
  }
)

#' @rdname kRp.corpus_get-methods
#' @docType methods
#' @export
setGeneric("corpusTTR", function(obj) standardGeneric("corpusTTR"))
#' @rdname kRp.corpus_get-methods
#' @docType methods
#' @export
#' @aliases
#'    corpusTTR,-methods
#'    corpusTTR,kRp.corpus-method
#' @include 01_class_01_kRp.corpus.R
setMethod("corpusTTR",
  signature=signature(obj="kRp.corpus"),
  function (obj){
    result <- slot(obj, name="TTR")
    return(result)
  }
)

#' @rdname kRp.corpus_get-methods
#' @export
#' @docType methods
# @param value The new value to replace the current with.
setGeneric("corpusTTR<-", function(obj, value) standardGeneric("corpusTTR<-"))
#' @rdname kRp.corpus_get-methods
#' @export
#' @docType methods
#' @aliases
#'    corpusTTR<-,-methods
#'    corpusTTR<-,kRp.corpus-method
#' @include 01_class_01_kRp.corpus.R
setMethod("corpusTTR<-",
  signature=signature(obj="kRp.corpus"),
  function (obj, value){
    slot(obj, name="TTR") <- value
    return(obj)
  }
)


#' @rdname kRp.corpus_get-methods
#' @docType methods
#' @export
setGeneric("corpusSources", function(obj, source=NULL) standardGeneric("corpusSources"))
#' @rdname kRp.corpus_get-methods
#' @docType methods
#' @param source Character value, name of a source in this object. If given, you get/set only the value of this source.
#' @export
#' @aliases
#'    corpusSources,-methods
#'    corpusSources,kRp.sourcesCorpus-method
#' @include 01_class_02_kRp.sourcesCorpus.R
setMethod("corpusSources",
  signature=signature(obj="kRp.sourcesCorpus"),
  function (obj, source=NULL){
    all.sources <- slot(obj, name="sources")
    if(is.null(source)){
      result <- all.sources
    } else {
      if(source %in% names(all.sources)){
        result <- all.sources[[source]]
      } else {
        stop(simpleError(paste0("Source named \"", source,"\" not found in this object!")))
      }
    }
    
    return(result)
  }
)

#' @rdname kRp.corpus_get-methods
#' @export
#' @docType methods
# @param value The new value to replace the current with.
setGeneric("corpusSources<-", function(obj, source=NULL, value) standardGeneric("corpusSources<-"))
#' @rdname kRp.corpus_get-methods
#' @export
#' @docType methods
#' @aliases
#'    corpusSources<-,-methods
#'    corpusSources<-,kRp.sourcesCorpus-method
#' @include 01_class_02_kRp.sourcesCorpus.R
setMethod("corpusSources<-",
  signature=signature(obj="kRp.sourcesCorpus"),
  function (obj, source=NULL, value){
    if(is.null(source)){
      slot(obj, name="sources") <- value
    } else {
      slot(obj, name="sources")[[source]] <- value
    }

    return(obj)
  }
)


#' @rdname kRp.corpus_get-methods
#' @param topic Character value, name of a topic in this object. If given, you get/set only the value of this topic.
#' @docType methods
#' @export
setGeneric("corpusTopics", function(obj, topic=NULL) standardGeneric("corpusTopics"))
#' @rdname kRp.corpus_get-methods
#' @docType methods
#' @export
#' @aliases
#'    corpusTopics,-methods
#'    corpusTopics,kRp.topicCorpus-method
#' @include 01_class_03_kRp.topicCorpus.R
setMethod("corpusTopics",
  signature=signature(obj="kRp.topicCorpus"),
  function (obj, topic=NULL){
    all.topics <- slot(obj, name="topics")
    if(is.null(topic)){
      result <- all.topics
    } else {
      if(topic %in% names(all.topics)){
        result <- all.topics[[topic]]
      } else {
        stop(simpleError(paste0("Topic named \"", topic,"\" not found in this object!")))
      }
    }
    
    return(result)
  }
)

#' @rdname kRp.corpus_get-methods
#' @export
#' @docType methods
# @param value The new value to replace the current with.
setGeneric("corpusTopics<-", function(obj, topic=NULL, value) standardGeneric("corpusTopics<-"))
#' @rdname kRp.corpus_get-methods
#' @export
#' @docType methods
#' @aliases
#'    corpusTopics<-,-methods
#'    corpusTopics<-,kRp.topicCorpus-method
#' @include 01_class_03_kRp.topicCorpus.R
setMethod("corpusTopics<-",
  signature=signature(obj="kRp.topicCorpus"),
  function (obj, topic=NULL, value){
    if(is.null(topic)){
      slot(obj, name="topics") <- value
    } else {
      slot(obj, name="topics")[[topic]] <- value
    }

    return(obj)
  }
)

#' @rdname kRp.corpus_get-methods
#' @docType methods
#' @export
setGeneric("corpusFreq", function(obj) standardGeneric("corpusFreq"))
#' @rdname kRp.corpus_get-methods
#' @docType methods
#' @export
#' @aliases
#'    corpusFreq,-methods
#'    corpusFreq,kRp.corpus-method
#' @include 01_class_01_kRp.corpus.R
setMethod("corpusFreq",
  signature=signature(obj="kRp.corpus"),
  function (obj){
    result <- slot(obj, name="freq")
    return(result)
  }
)

#' @rdname kRp.corpus_get-methods
#' @docType methods
#' @export
#' @aliases
#'    corpusFreq,-methods
#'    corpusFreq,kRp.sourcesCorpus-method
#' @include 01_class_02_kRp.sourcesCorpus.R
setMethod("corpusFreq",
  signature=signature(obj="kRp.sourcesCorpus"),
  function (obj){
    result <- slot(obj, name="freq")
    return(result)
  }
)

#' @rdname kRp.corpus_get-methods
#' @docType methods
#' @export
#' @aliases
#'    corpusFreq,-methods
#'    corpusFreq,kRp.topicCorpus-method
#' @include 01_class_03_kRp.topicCorpus.R
setMethod("corpusFreq",
  signature=signature(obj="kRp.topicCorpus"),
  function (obj){
    result <- slot(obj, name="freq")
    return(result)
  }
)

#' @rdname kRp.corpus_get-methods
#' @export
#' @docType methods
# @param value The new value to replace the current with.
setGeneric("corpusFreq<-", function(obj, topic, value) standardGeneric("corpusFreq<-"))
#' @rdname kRp.corpus_get-methods
#' @export
#' @docType methods
#' @aliases
#'    corpusFreq<-,-methods
#'    corpusFreq<-,kRp.corpus-method
#' @include 01_class_01_kRp.corpus.R
setMethod("corpusFreq<-",
  signature=signature(obj="kRp.corpus"),
  function (obj, value){
    slot(obj, name="freq") <- value
    return(obj)
  }
)

#' @rdname kRp.corpus_get-methods
#' @export
#' @docType methods
#' @aliases
#'    corpusFreq<-,-methods
#'    corpusFreq<-,kRp.sourcesCorpus-method
#' @include 01_class_02_kRp.sourcesCorpus.R
setMethod("corpusFreq<-",
  signature=signature(obj="kRp.sourcesCorpus"),
  function (obj, value){
    slot(obj, name="freq") <- value
    return(obj)
  }
)

#' @rdname kRp.corpus_get-methods
#' @export
#' @docType methods
#' @aliases
#'    corpusFreq<-,-methods
#'    corpusFreq<-,kRp.topicCorpus-method
#' @include 01_class_03_kRp.topicCorpus.R
setMethod("corpusFreq<-",
  signature=signature(obj="kRp.topicCorpus"),
  function (obj, value){
    slot(obj, name="freq") <- value
    return(obj)
  }
)

#' @rdname kRp.corpus_get-methods
#' @export
#' @include 01_class_01_kRp.corpus.R
is.corpus <- function(obj){
  inherits(obj, "kRp.corpus")
}

#' @rdname kRp.corpus_get-methods
#' @param x See \code{obj}.
#' @param i Defines the row selector (\code{[}) or the name to match (\code{[[}) in the summary slot.
#' @param j Defines the column selector in the summary slot.
#' @export
#' @docType methods
#' @aliases
#'    [,-methods
#'    [,kRp.corpus,ANY,ANY-method
setMethod("[",
  signature=signature(x="kRp.corpus"),
  function (x, i, j){
    return(corpusSummary(x)[i, j])
  }
)
#' @rdname kRp.corpus_get-methods
#' @export
#' @docType methods
#' @aliases
#'    [,-methods
#'    [,kRp.sourcesCorpus,ANY,ANY,ANY-method
setMethod("[",
  signature=signature(x="kRp.sourcesCorpus"),
  function (x, i, j){
    return(corpusSummary(x)[i, j])
  }
)
#' @rdname kRp.corpus_get-methods
#' @export
#' @docType methods
#' @aliases
#'    [,-methods
#'    [,kRp.topicCorpus,ANY,ANY,ANY-method
setMethod("[",
  signature=signature(x="kRp.topicCorpus"),
  function (x, i, j){
    return(corpusSummary(x)[i, j])
  }
)

#' @rdname kRp.corpus_get-methods
#' @export
#' @docType methods
#' @aliases
#'    [<-,-methods
#'    [<-,kRp.corpus,ANY,ANY,ANY-method
setMethod("[<-",
  signature=signature(x="kRp.corpus"),
  function (x, i, j, value){
    corpusSummary(x)[i, j] <- value
    return(x)
  }
)
#' @rdname kRp.corpus_get-methods
#' @export
#' @docType methods
#' @aliases
#'    [<-,-methods
#'    [<-,kRp.sourcesCorpus,ANY,ANY,ANY-method
setMethod("[<-",
  signature=signature(x="kRp.sourcesCorpus"),
  function (x, i, j, value){
    corpusSummary(x)[i, j] <- value
    return(x)
  }
)
#' @rdname kRp.corpus_get-methods
#' @export
#' @docType methods
#' @aliases
#'    [<-,-methods
#'    [<-,kRp.topicCorpus,ANY,ANY,ANY-method
setMethod("[<-",
  signature=signature(x="kRp.topicCorpus"),
  function (x, i, j, value){
    corpusSummary(x)[i, j] <- value
    return(x)
  }
)

#' @rdname kRp.corpus_get-methods
#' @export
#' @docType methods
#' @aliases
#'    [[,-methods
#'    [[,kRp.corpus,ANY-method
setMethod("[[",
  signature=signature(x="kRp.corpus"),
  function (x, i){
    return(corpusSummary(x)[[i]])
  }
)
#' @rdname kRp.corpus_get-methods
#' @export
#' @docType methods
#' @aliases
#'    [[,-methods
#'    [[,kRp.sourcesCorpus,ANY-method
setMethod("[[",
  signature=signature(x="kRp.sourcesCorpus"),
  function (x, i){
    return(corpusSummary(x)[[i]])
  }
)
#' @rdname kRp.corpus_get-methods
#' @export
#' @docType methods
#' @aliases
#'    [[,-methods
#'    [[,kRp.topicCorpus,ANY-method
setMethod("[[",
  signature=signature(x="kRp.topicCorpus"),
  function (x, i){
    return(corpusSummary(x)[[i]])
  }
)

#' @rdname kRp.corpus_get-methods
#' @export
#' @docType methods
#' @aliases
#'    [[<-,-methods
#'    [[<-,kRp.corpus,ANY,ANY-method
setMethod("[[<-",
  signature=signature(x="kRp.corpus"),
  function (x, i, value){
    corpusSummary(x)[[i]] <- value
    return(x)
  }
)
#' @rdname kRp.corpus_get-methods
#' @export
#' @docType methods
#' @aliases
#'    [[<-,-methods
#'    [[<-,kRp.sourcesCorpus,ANY,ANY-method
setMethod("[[<-",
  signature=signature(x="kRp.sourcesCorpus"),
  function (x, i, value){
    corpusSummary(x)[[i]] <- value
    return(x)
  }
)
#' @rdname kRp.corpus_get-methods
#' @export
#' @docType methods
#' @aliases
#'    [[<-,-methods
#'    [[<-,kRp.topicCorpus,ANY,ANY-method
setMethod("[[<-",
  signature=signature(x="kRp.topicCorpus"),
  function (x, i, value){
    corpusSummary(x)[[i]] <- value
    return(x)
  }
)

#' @rdname kRp.corpus_get-methods
#' @docType methods
#' @export
setGeneric("tif_as_tokens_df", function(tokens) standardGeneric("tif_as_tokens_df"))
#' @rdname kRp.corpus_get-methods
#' @param tokens See \code{obj}.
#' @export
#' @docType methods
#' @aliases
#'    tif_as_tokens_df,-methods
#'    tif_as_tokens_df,kRp.corpus-method
setMethod("tif_as_tokens_df",
  signature=signature(tokens="kRp.corpus"),
  function(tokens){
    result <- do.call(rbind.data.frame, lapply(corpusTagged(tokens), tif_as_tokens_df))
    return(result)
  }
)
#' @rdname kRp.corpus_get-methods
#' @export
#' @docType methods
#' @aliases
#'    tif_as_tokens_df,-methods
#'    tif_as_tokens_df,kRp.sourcesCorpus-method
setMethod("tif_as_tokens_df",
  signature=signature(tokens="kRp.sourcesCorpus"),
  function(tokens){
    result <- do.call(rbind.data.frame, lapply(corpusSources(tokens), tif_as_tokens_df))
    return(result)
  }
)
#' @rdname kRp.corpus_get-methods
#' @export
#' @docType methods
#' @aliases
#'    tif_as_tokens_df,-methods
#'    tif_as_tokens_df,kRp.topicCorpus-method
setMethod("tif_as_tokens_df",
  signature=signature(tokens="kRp.topicCorpus"),
  function(tokens){
    result <- do.call(rbind.data.frame, lapply(corpusTopics(tokens), tif_as_tokens_df))
    return(result)
  }
)
